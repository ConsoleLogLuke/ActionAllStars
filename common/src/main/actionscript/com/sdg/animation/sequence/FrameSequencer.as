package com.sdg.animation.sequence{	import com.sdg.animation.AbstractAnimator;	import com.sdg.animation.IAnimator;	import com.sdg.animation.PlaybackInfo;	import com.sdg.collections.QuickList;	import com.sdg.events.IntervalEvent;		public class FrameSequencer extends AbstractAnimator implements IAnimator	{		private static const NULL_SEQUENCE_CURSOR:NullSequenceCursor = new NullSequenceCursor();				private var _keyframe:SequenceFrame;		private var _cursor:ISequenceCursor = NULL_SEQUENCE_CURSOR;		private var _sequence:ISequence;				public function get currentIndex():int		{			return _cursor.currentIndex;		}				public function get sequence():ISequence		{			return _sequence;		}				public function set sequence(value:ISequence):void		{			if (value != _sequence) setSequence(value);		}				public function FrameSequencer(sequence:ISequence = null)		{			super(intervalHandler, 0);			if (sequence) setSequence(sequence);		}				public function gotoFrame(index:uint):void		{			if (!_cursor.checkIndex(index) && isPlaying)			{				if (setLoopComplete())					renderFrame(0);				else				{					renderFrame(index);					setAnimationComplete();				}			}			else				renderFrame(index);		}				public function nextFrame():void		{			gotoFrame(_cursor.currentIndex + 1);		}				override public function reset():void		{			super.reset();			gotoFrame(0);		}				private function intervalHandler(event:IntervalEvent):void		{			gotoFrame(_cursor.currentIndex + 1);		}				private function renderFrame(index:uint):void		{			var keyframe:SequenceFrame = _cursor.seekKeyframe(index);						if (keyframe && keyframe !== _keyframe)			{				_keyframe = keyframe;								var i:int = _keyframe.events.length;								while (--i > -1)				{					dispatchEvent(_keyframe.events[i]);				}			}		}				private function setSequence(sequence:ISequence):void		{			var index:int = _cursor.currentIndex;						_sequence = sequence;						if (_sequence)			{				_cursor = _sequence.getSequenceCursor();								if (_sequence.playbackInfo)				{					interval = _sequence.playbackInfo.interval;					intervalType = _sequence.playbackInfo.intervalType;					loopCount = _sequence.playbackInfo.loopCount;				}			}			else				_cursor = NULL_SEQUENCE_CURSOR;						gotoFrame(index);		}	}}